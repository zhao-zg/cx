<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ç‰¹ä¼šä¿¡æ¯ - åŠ è½½ä¸­">
    <meta name="theme-color" content="#667eea">
    <title>ç‰¹ä¼šä¿¡æ¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .container {
            text-align: center;
            padding: 20px;
        }
        
        .logo {
            font-size: 64px;
            margin-bottom: 20px;
            cursor: pointer;
            user-select: none;
        }
        
        h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .loading {
            font-size: 16px;
            opacity: 0.9;
            margin-top: 20px;
        }
        
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        
        .error.show {
            display: block;
        }
        
        .btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .update-info {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
            font-size: 14px;
        }
        
        .update-info.show {
            display: block;
        }
        
        .progress {
            background: rgba(255, 255, 255, 0.2);
            height: 4px;
            border-radius: 2px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-bar {
            background: white;
            height: 100%;
            width: 0%;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo" id="logo">ğŸ“–</div>
        <h1>ç‰¹ä¼šä¿¡æ¯</h1>
        <div class="loading" id="status">æ­£åœ¨åŠ è½½...</div>
        <div class="spinner" id="spinner"></div>
        
        <div class="error" id="error">
            <p id="errorMsg">åŠ è½½å¤±è´¥</p>
            <button class="btn" onclick="location.reload()">é‡è¯•</button>
        </div>
        
        <div class="update-info" id="updateInfo">
            <p id="updateMsg">æ£€æŸ¥æ›´æ–°ä¸­...</p>
            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>
    </div>
    
    <script>
        // é…ç½®
        const CONFIG = {
            // è¿œç¨‹å†…å®¹åœ°å€ï¼ˆGitHub Pages æˆ–å…¶ä»–é™æ€æ‰˜ç®¡ï¼‰
            // è¯·åœ¨æ„å»ºæ—¶æ›¿æ¢ä¸ºå®é™…åœ°å€
            REMOTE_URL: 'https://YOUR_USERNAME.github.io/YOUR_REPO/',
            // æœ¬åœ°å­˜å‚¨é”®
            STORAGE_KEY: 'cx_content_version',
            // ç‚¹å‡»æ¬¡æ•°è§¦å‘æ›´æ–°æ£€æŸ¥
            CLICK_COUNT_TRIGGER: 10
        };
        
        let clickCount = 0;
        let isUpdating = false;
        
        // Logo ç‚¹å‡»è®¡æ•°
        document.getElementById('logo').addEventListener('click', function() {
            if (isUpdating) return;
            
            clickCount++;
            console.log('ç‚¹å‡»æ¬¡æ•°:', clickCount);
            
            if (clickCount >= CONFIG.CLICK_COUNT_TRIGGER) {
                clickCount = 0;
                checkForUpdates(true);
            }
        });
        
        // æ£€æŸ¥æ›´æ–°
        async function checkForUpdates(manual = false) {
            if (isUpdating) return;
            isUpdating = true;
            
            const updateInfo = document.getElementById('updateInfo');
            const updateMsg = document.getElementById('updateMsg');
            const progressBar = document.getElementById('progressBar');
            
            updateInfo.classList.add('show');
            updateMsg.textContent = 'æ£€æŸ¥æ›´æ–°ä¸­...';
            progressBar.style.width = '10%';
            
            try {
                // è·å–è¿œç¨‹ç‰ˆæœ¬ä¿¡æ¯
                const response = await fetch(CONFIG.REMOTE_URL + 'version.json?t=' + Date.now());
                if (!response.ok) throw new Error('æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨');
                
                const remoteVersion = await response.json();
                const localVersion = localStorage.getItem(CONFIG.STORAGE_KEY);
                
                progressBar.style.width = '30%';
                
                if (localVersion !== remoteVersion.version || manual) {
                    updateMsg.textContent = 'å‘ç°æ–°ç‰ˆæœ¬ï¼Œæ­£åœ¨ä¸‹è½½...';
                    progressBar.style.width = '50%';
                    
                    // ä¸‹è½½å¹¶ç¼“å­˜æ–°å†…å®¹
                    await cacheContent(remoteVersion);
                    
                    progressBar.style.width = '100%';
                    updateMsg.textContent = 'æ›´æ–°å®Œæˆï¼';
                    
                    // ä¿å­˜ç‰ˆæœ¬å·
                    localStorage.setItem(CONFIG.STORAGE_KEY, remoteVersion.version);
                    
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                } else {
                    progressBar.style.width = '100%';
                    updateMsg.textContent = 'å·²æ˜¯æœ€æ–°ç‰ˆæœ¬';
                    setTimeout(() => {
                        updateInfo.classList.remove('show');
                        isUpdating = false;
                    }, 2000);
                }
            } catch (error) {
                console.error('æ›´æ–°æ£€æŸ¥å¤±è´¥:', error);
                updateMsg.textContent = 'æ›´æ–°æ£€æŸ¥å¤±è´¥: ' + error.message;
                setTimeout(() => {
                    updateInfo.classList.remove('show');
                    isUpdating = false;
                }, 3000);
            }
        }
        
        // ç¼“å­˜å†…å®¹
        async function cacheContent(versionInfo) {
            if (!('serviceWorker' in navigator)) return;
            
            const registration = await navigator.serviceWorker.ready;
            const cache = await caches.open('cx-content-' + versionInfo.version);
            
            // ç¼“å­˜ä¸»è¦æ–‡ä»¶
            const filesToCache = [
                CONFIG.REMOTE_URL,
                CONFIG.REMOTE_URL + 'index.html',
                ...(versionInfo.files || [])
            ];
            
            await cache.addAll(filesToCache);
        }
        
        // åŠ è½½å†…å®¹
        async function loadContent() {
            const status = document.getElementById('status');
            const spinner = document.getElementById('spinner');
            const error = document.getElementById('error');
            const errorMsg = document.getElementById('errorMsg');
            
            try {
                // é¦–å…ˆå°è¯•ä»ç¼“å­˜åŠ è½½
                const cache = await caches.open('cx-content');
                const cachedResponse = await cache.match(CONFIG.REMOTE_URL + 'index.html');
                
                if (cachedResponse) {
                    // æœ‰ç¼“å­˜ï¼Œç›´æ¥è·³è½¬
                    window.location.href = CONFIG.REMOTE_URL + 'index.html';
                    return;
                }
                
                // æ²¡æœ‰ç¼“å­˜ï¼Œä»ç½‘ç»œåŠ è½½
                status.textContent = 'é¦–æ¬¡åŠ è½½ï¼Œè¯·ç¨å€™...';
                
                const response = await fetch(CONFIG.REMOTE_URL + 'index.html');
                if (!response.ok) throw new Error('æ— æ³•åŠ è½½å†…å®¹');
                
                // ç¼“å­˜å†…å®¹
                await cache.put(CONFIG.REMOTE_URL + 'index.html', response.clone());
                
                // è·³è½¬
                window.location.href = CONFIG.REMOTE_URL + 'index.html';
                
            } catch (err) {
                console.error('åŠ è½½å¤±è´¥:', err);
                spinner.style.display = 'none';
                status.style.display = 'none';
                errorMsg.textContent = 'åŠ è½½å¤±è´¥: ' + err.message;
                error.classList.add('show');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        window.addEventListener('load', function() {
            // è‡ªåŠ¨æ£€æŸ¥æ›´æ–°ï¼ˆé™é»˜ï¼‰
            checkForUpdates(false);
            
            // åŠ è½½å†…å®¹
            setTimeout(loadContent, 1000);
        });
    </script>
</body>
</html>
