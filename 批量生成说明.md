# 批量生成功能说明

## 功能概述

系统现在支持**批量处理**多个批次的文档,自动扫描 `resource` 目录下的子文件夹,为每个批次生成独立的HTML输出。

## 目录结构

### 输入目录结构

```
resource/
├── 2025-秋季/
│   ├── 听抄.docx (或 .doc)
│   ├── 经文.docx (或 .doc)
│   └── 晨兴.doc (或 .docx)
├── 2025-夏季/
│   ├── 听抄.doc
│   ├── 经文.docx
│   └── 晨兴.doc
└── 2024-春季/
    ├── 听抄.docx
    ├── 经文.docx
    └── 晨兴.docx
```

### 输出目录结构

```
output/
├── 2025-秋季/
│   ├── index.html
│   ├── 1_dg.htm ~ 9_dg.htm
│   ├── 1_cv.htm ~ 9_cv.htm
│   ├── 1_cx.htm ~ 9_cx.htm
│   └── ...
├── 2025-夏季/
│   ├── index.html
│   ├── 1_dg.htm ~ 9_dg.htm
│   └── ...
├── 2024-春季/
│   └── ...
└── images/
    └── (各批次共享的图片资源)
```

## 使用方法

### 1. 准备文档

将不同批次的文档按文件夹组织:

```bash
# 创建批次文件夹
mkdir resource/2025-秋季
mkdir resource/2025-夏季

# 放入对应的文档
# 每个文件夹需要包含: 听抄、经文、晨兴 三个文档
```

### 2. 运行批量生成

```powershell
python main.py
```

### 3. 查看输出

程序会自动:
- ✅ 扫描 `resource/` 下的所有子文件夹
- ✅ 检测每个文件夹中的文档 (支持 .doc 和 .docx)
- ✅ 为每个批次生成独立的输出目录
- ✅ 显示详细的处理进度和结果

### 输出示例

```
============================================================
 Word文档静态网站生成器 (批量版)
============================================================

✓ 配置文件加载成功
✓ 找到 2 个批次:
  - 2025-夏季
  - 2025-秋季

============================================================
 处理批次: 2025-夏季
============================================================

✓ 找到听抄文档: 听抄.doc
✓ 找到经文文档: 经文.docx
✓ 找到晨兴文档: 晨兴.doc

开始解析Word文档...
  解析纲目结构（经文.docx）...
  解析详细内容（听抄.doc）...
  解析晨兴内容（晨兴.doc）...
✓ 成功解析 9 个篇章

开始生成HTML文件到: output\2025-夏季
✓ 生成首页: index.html
...

============================================================
✓ 2025-夏季 所有文件已生成到: output\2025-夏季
✓ 打开 output\2025-夏季/index.html 查看结果
============================================================

[处理下一个批次...]

============================================================
 批量生成完成
============================================================
✓ 成功: 2 个批次

所有输出文件位于: output/
============================================================
```

## 配置说明

### config.yaml

```yaml
# 训练配置
title: "二〇二五年秋季国际长老及负责弟兄训练"
subtitle: "马太福音五至七章极重要的方面"
year: 2025
season: "秋季"

# 批量处理配置
resource_dir: "resource"  # 包含批次子文件夹的目录
output_dir: "output"      # 输出根目录
template_dir: "src/templates"
```

## 文件命名规则

### 必需文件

每个批次文件夹必须包含以下文件(可以是 .doc 或 .docx):

| 文件名 | 说明 | 格式 |
|-------|------|------|
| `听抄` | 听抄内容文档 | .doc 或 .docx |
| `经文` | 经文纲目文档 | .doc 或 .docx |
| `晨兴` | 晨兴内容文档 | .doc 或 .docx (可选) |

### 文件名示例

✅ **正确的命名**:
- `听抄.docx`
- `听抄.doc`
- `经文.docx`
- `经文.doc`
- `晨兴.doc`
- `晨兴.docx`

❌ **错误的命名**:
- `听抄文档.docx` (文件名不对)
- `经文 2025.docx` (有额外内容)
- `晨兴-秋季.doc` (有额外内容)

## 批次文件夹命名

### 推荐命名规范

```
YYYY-季节/
```

示例:
- `2025-秋季/`
- `2025-夏季/`
- `2024-春季/`
- `2024-冬季/`

### 也支持其他命名

实际上文件夹名可以是任何名称,程序会原样使用:
- `Fall-2025/`
- `国际长老训练-秋季/`
- `马太福音训练/`

输出目录会使用相同的名称。

## 处理逻辑

### 自动检测

程序会自动:
1. 扫描 `resource/` 下的所有子文件夹
2. 跳过隐藏文件夹 (以 `.` 开头)
3. 按字母顺序处理批次
4. 为每个批次查找必需的文档文件

### 格式自动识别

- 优先查找 `.docx` 格式
- 如果不存在,自动回退到 `.doc`
- 支持混合格式(如: 听抄.doc + 经文.docx)

### 错误处理

#### 跳过缺失文档的批次

如果某个批次缺少必需文档,会跳过该批次:

```
⚠ 跳过 2025-春季: 未找到听抄文档
```

#### 晨兴文档可选

晨兴文档不是必需的:

```
⚠ 未找到晨兴文档,将跳过晨兴内容
```

程序会继续处理,只是不生成晨兴页面。

## 批量生成优势

### 1. 节省时间

一次运行处理多个批次,无需手动切换配置。

### 2. 组织清晰

每个批次独立的输出目录,便于管理和分发。

### 3. 格式灵活

支持不同批次使用不同的文档格式。

### 4. 易于扩展

添加新批次只需创建新文件夹并放入文档。

## 常见场景

### 场景1: 处理多个训练期次

```
resource/
├── 2025-秋季-国际长老训练/
├── 2025-夏季-国际长老训练/
├── 2024-冬季-国际长老训练/
└── 2024-秋季-国际长老训练/
```

运行一次 `python main.py` 即可生成所有期次。

### 场景2: 处理不同主题

```
resource/
├── 马太福音训练/
├── 腓立比书训练/
└── 启示录训练/
```

### 场景3: 增量处理

已有的批次:
```
output/
├── 2025-夏季/  (已生成)
└── 2024-春季/  (已生成)
```

新增批次:
```
resource/
└── 2025-秋季/  (新增)
```

运行程序会处理所有批次,包括新增的。

## 高级用法

### 仅处理特定批次

如果只想处理某一个批次,可以临时移动其他文件夹:

```bash
# 临时移动不需要的批次
mv resource/2025-夏季 resource-backup/

# 运行生成
python main.py

# 恢复
mv resource-backup/2025-夏季 resource/
```

### 清理旧输出

在重新生成前清理旧输出:

```powershell
Remove-Item -Recurse -Force output/*
python main.py
```

### 验证文档

检查每个批次文件夹是否包含必需文档:

```powershell
Get-ChildItem resource -Directory | ForEach-Object {
    $folder = $_
    Write-Host "检查 $($folder.Name):"
    "听抄", "经文", "晨兴" | ForEach-Object {
        $doc = Get-ChildItem $folder.FullName -Filter "$_.*" | Select-Object -First 1
        if ($doc) {
            Write-Host "  ✓ $_: $($doc.Name)"
        } else {
            Write-Host "  ✗ $_: 未找到"
        }
    }
}
```

## 性能考虑

### 处理时间

- 每个批次约需 10-30 秒(取决于文档大小)
- .doc 格式比 .docx 稍慢(需要转换)
- 批次越多,总时间越长

### 建议

- 第一次运行可能较慢(COM组件初始化)
- 后续运行会更快
- 可以关闭不必要的Word进程以提升速度

## 故障排除

### Q: 程序说找不到批次文件夹?

A: 检查 `config.yaml` 中的 `resource_dir` 配置是否正确。

### Q: 某个批次被跳过了?

A: 检查该批次文件夹中是否包含 `听抄` 和 `经文` 文档。

### Q: .doc 文件解析失败?

A: 确保:
1. 安装了 `pywin32`: `pip install pywin32`
2. 在 Windows 系统上运行
3. 有 Microsoft Word (COM 需要)

### Q: 输出目录中有重复内容?

A: 每次运行会覆盖同名批次的输出,确保 resource 文件夹名称唯一。

## 总结

批量生成功能让您能够:
- ✅ 一次处理多个训练期次
- ✅ 自动管理不同批次的输出
- ✅ 支持混合文档格式
- ✅ 灵活的文件夹组织方式
- ✅ 清晰的进度反馈

只需将文档按批次组织好,运行一次命令即可完成所有批次的生成!

---

**版本**: 2.0  
**更新日期**: 2025年12月12日  
**新增功能**: 批量处理多个批次
